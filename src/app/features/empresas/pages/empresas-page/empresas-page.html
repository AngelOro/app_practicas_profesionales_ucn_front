<p-toast></p-toast>

<app-header
  icon="pi pi-building"
  title="Empresas"
  subtitle="Gestiona las empresas"
>
  <button pButton label="Nuevo" icon="pi pi-plus" (click)="openNew()"></button>
</app-header>

<p-table
  [value]="empresas"
  [paginator]="true"
  [rows]="5"
  responsiveLayout="scroll"
  [tableStyle]="{ 'min-width': '50rem' }"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Nombre</th>
      <th>NIT</th>
      <th>Telefono</th>
      <th>Activa</th>
      <th style="width: 10rem">Acciones</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-emp>
    <tr>
      <td>{{ emp.nombre }}</td>
      <td>{{ emp.nit }}</td>
      <td>{{ emp.telefono }}</td>
      <td>
        <p-tag [value]="emp.activo ? 'Sí' : 'No'" [severity]="emp.activo ? 'success' : 'danger'"></p-tag>
      </td>
      <td>
        <button pButton icon="pi pi-pencil" rounded outlined class="p-mr-2" (click)="openEdit(emp)"></button>
        <button pButton icon="pi pi-trash" rounded outlined severity="danger" (click)="desactivar(emp)"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="dialog"
  [modal]="true"
  [style]="{ width: '640px', maxWidth: '94vw' }"
  [contentStyle]="{ padding: '0' }"
  [showHeader]="false"
  [closable]="false"
  [draggable]="false"
  (onHide)="dialog=false"
>
  <form class="dialog-form" (ngSubmit)="save()" novalidate>
    <div class="dialog-banner">
      <div class="banner-icon"><i class="pi pi-building"></i></div>
      <div class="banner-text">
        <h3>{{ editing ? 'Editar empresa' : 'Nueva empresa' }}</h3>
        <span>Completa los campos obligatorios marcados con <b>*</b></span>
      </div>
      <button type="button" class="close-btn" (click)="dialog=false" pRipple [disabled]="saving">
        <i class="pi pi-times"></i>
      </button>
    </div>

    <div class="dialog-body grid">
      <div class="field col-12 md:col-6">
        <label for="nombre">Nombre <span class="req">*</span></label>
        <input id="nombre" pInputText [(ngModel)]="form.nombre" name="nombre"
               placeholder="Ej: Tech Solutions S.A.S."
               [ngClass]="{ 'invalid': isInvalid('nombre') }" class="w-full" />
        <small class="err" *ngIf="isInvalid('nombre')">El nombre es obligatorio.</small>
      </div>

      <div class="field col-12 md:col-6">
        <label for="nit">NIT <span class="req">*</span></label>
        <input id="nit" pInputText [(ngModel)]="form.nit" name="nit"
               placeholder="Ej: 900123456"
               [ngClass]="{ 'invalid': isInvalid('nit') }" class="w-full" />
        <small class="err" *ngIf="isInvalid('nit')">El NIT es obligatorio.</small>
      </div>

      <div class="field col-12 md:col-6">
        <label for="correo">Correo <span class="req">*</span></label>
        <input id="correo" pInputText [(ngModel)]="form.correo" name="correo"
               placeholder="contacto@empresa.com"
               [ngClass]="{ 'invalid': isInvalid('correo') || (submitted && !isEmail(form.correo)) }"
               class="w-full" />
        <small class="err" *ngIf="isInvalid('correo')">El correo es obligatorio.</small>
        <small class="err" *ngIf="submitted && form.correo && !isEmail(form.correo)">Correo inválido.</small>
      </div>

      <div class="field col-12 md:col-6">
        <label for="telefono">Teléfono <span class="req">*</span></label>
        <input id="telefono" pInputText [(ngModel)]="form.telefono" name="telefono"
               placeholder="Ej: 3109876543"
               [ngClass]="{ 'invalid': isInvalid('telefono') }" class="w-full" />
        <small class="err" *ngIf="isInvalid('telefono')">El teléfono es obligatorio.</small>
      </div>

      <div class="field col-12 md:col-6 flex align-items-center">
        <p-checkbox inputId="activo" [(ngModel)]="form.activo" name="activo" binary="true"></p-checkbox>
        <label for="activo" class="ml-2">Empresa activa</label>
      </div>
    </div>

    <div class="dialog-foot">
      <button type="button" pButton label="Cancelar" icon="pi pi-times"
              class="p-button-text" (click)="dialog=false" [disabled]="saving"></button>
      <button type="submit" pButton label="Guardar" icon="pi pi-check"
              [loading]="saving" [disabled]="saving || !isFormValid()"></button>
    </div>
  </form>
</p-dialog>

